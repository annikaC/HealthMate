{% extends "base.html" %}
{% load staticfiles leaflet_tags django_markdown %}
{% block content %}
{% leaflet_map "main" callback="main_map_init" settings_overrides=view.settings_overrides %}
    <script type="text/javascript">


        function onEachFeature(feature, layer) {
            if (feature.properties && feature.properties.popupContent) {
                layer.bindPopup(feature.properties.popupContent);
                layer._popup.options.minWidth = 300;
            }
        }

        function main_map_init (map, options) {
            var dataurl = '{% url "data" id=id %}';
            // Download GeoJSON via Ajax
            $.getJSON(dataurl, function (data) {
                // Add GeoJSON layer
                L.geoJson(data, {onEachFeature: onEachFeature}).addTo(map);
            });
        }

    </script>
{% endblock %}
